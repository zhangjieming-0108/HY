<!doctype html>
<html>
	<head>
		<title></title>
		<meta charset="utf8">
	</head>
	<body onload="getUser()">
	  
		用户名称:<input type="text" id="uname"><br>
		用户邮箱:<input type="text" id="email"><br>
		联系方式:<input type="text" id="phone"><br>
		真实姓名:<input type="text" id="user_name"><br>
		用户性别:<input type="radio" id="m"name="gender" value="1"><label for="m">男</label><input type="radio"id="f"name="gender"value="0"><label for="f">女</label><br>
		<button onclick="updateUser()">修改</button>
		<script>
			function updateUser(){
			var urlPar=new URLSearchParams(location.search);
			var $uid=urlPar.get("uid");
			var $uname=uname.value;
			var $email=email.value;
			var $phone=phone.value;
			var $user_name=user_name.value;
			var $gender="";
			if(m.checked){
			   $gender="1";
			 }else{
				$gender="0";
			 }
			 var xhr=new XMLHttpRequest();
			 xhr.onreadystatechange=function(){
				if(xhr.readyState==4 && xhr.status==200){
					var result=xhr.responseText;
					if(result==1){
					alert("修改成功");
					window.location.href="user_list.html";
					}else{
						alert("修改失败");
					}
				}
			 }
			 xhr.open("put","user/v5/update",true);
			 xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
			 var formdata="uname="+$uname+"&email="+$email+"&phone="+$phone+"&user_name="+$user_name+"&gender="+$gender+"&uid="+$uid;
			 console.log(formdata);
			 xhr.send(formdata);
			}
			function getUser(){
				var urlPar=new URLSearchParams(location.search);
				var uid=urlPar.get("uid");
				var xhr=new XMLHttpRequest();
				xhr.onreadystatechange=function(){
					if(xhr.readyState==4 && xhr.status==200){
						var result=xhr.responseText;
						var arr=JSON.parse(result)[0];
						uname.value=arr.uname;
						email.value=arr.email;
						phone.value=arr.phone;
						user_name.value=arr.user_name;
						if(arr.gender==1){
							m.checked=true
						}else{
							f.checked=true
						}
					}
				}
				xhr.open("get","/user/v5/query/"+uid,true);
				xhr.send();
			}
		</script>
	</body>
</html>